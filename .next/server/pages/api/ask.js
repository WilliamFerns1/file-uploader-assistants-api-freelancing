"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/ask";
exports.ids = ["pages/api/ask"];
exports.modules = {

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "axios":
/*!************************!*\
  !*** external "axios" ***!
  \************************/
/***/ ((module) => {

module.exports = import("axios");;

/***/ }),

/***/ "openai":
/*!*************************!*\
  !*** external "openai" ***!
  \*************************/
/***/ ((module) => {

module.exports = import("openai");;

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("fs");

/***/ }),

/***/ "(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fask&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fask.js&middlewareConfigBase64=e30%3D!":
/*!************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fask&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fask.js&middlewareConfigBase64=e30%3D! ***!
  \************************************************************************************************************************************************************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/pages-api/module.compiled */ \"(api)/./node_modules/next/dist/server/future/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(api)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_ask_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./pages/api/ask.js */ \"(api)/./pages/api/ask.js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_pages_api_ask_js__WEBPACK_IMPORTED_MODULE_3__]);\n_pages_api_ask_js__WEBPACK_IMPORTED_MODULE_3__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_ask_js__WEBPACK_IMPORTED_MODULE_3__, \"default\"));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_ask_js__WEBPACK_IMPORTED_MODULE_3__, \"config\");\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/ask\",\n        pathname: \"/api/ask\",\n        // The following aren't used in production.\n        bundlePath: \"\",\n        filename: \"\"\n    },\n    userland: _pages_api_ask_js__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LXJvdXRlLWxvYWRlci9pbmRleC5qcz9raW5kPVBBR0VTX0FQSSZwYWdlPSUyRmFwaSUyRmFzayZwcmVmZXJyZWRSZWdpb249JmFic29sdXRlUGFnZVBhdGg9LiUyRnBhZ2VzJTJGYXBpJTJGYXNrLmpzJm1pZGRsZXdhcmVDb25maWdCYXNlNjQ9ZTMwJTNEISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7OztBQUFzRztBQUN2QztBQUNMO0FBQzFEO0FBQytDO0FBQy9DO0FBQ0EsaUVBQWUsd0VBQUssQ0FBQyw4Q0FBUSxZQUFZLEVBQUM7QUFDMUM7QUFDTyxlQUFlLHdFQUFLLENBQUMsOENBQVE7QUFDcEM7QUFDTyx3QkFBd0IsZ0hBQW1CO0FBQ2xEO0FBQ0EsY0FBYyx5RUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLFlBQVk7QUFDWixDQUFDOztBQUVELHFDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbXktbmV4dC1hcHAvPzk2ZWMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUGFnZXNBUElSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1tb2R1bGVzL3BhZ2VzLWFwaS9tb2R1bGUuY29tcGlsZWRcIjtcbmltcG9ydCB7IFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBob2lzdCB9IGZyb20gXCJuZXh0L2Rpc3QvYnVpbGQvdGVtcGxhdGVzL2hlbHBlcnNcIjtcbi8vIEltcG9ydCB0aGUgdXNlcmxhbmQgY29kZS5cbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCIuL3BhZ2VzL2FwaS9hc2suanNcIjtcbi8vIFJlLWV4cG9ydCB0aGUgaGFuZGxlciAoc2hvdWxkIGJlIHRoZSBkZWZhdWx0IGV4cG9ydCkuXG5leHBvcnQgZGVmYXVsdCBob2lzdCh1c2VybGFuZCwgXCJkZWZhdWx0XCIpO1xuLy8gUmUtZXhwb3J0IGNvbmZpZy5cbmV4cG9ydCBjb25zdCBjb25maWcgPSBob2lzdCh1c2VybGFuZCwgXCJjb25maWdcIik7XG4vLyBDcmVhdGUgYW5kIGV4cG9ydCB0aGUgcm91dGUgbW9kdWxlIHRoYXQgd2lsbCBiZSBjb25zdW1lZC5cbmV4cG9ydCBjb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBQYWdlc0FQSVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5QQUdFU19BUEksXG4gICAgICAgIHBhZ2U6IFwiL2FwaS9hc2tcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9hc2tcIixcbiAgICAgICAgLy8gVGhlIGZvbGxvd2luZyBhcmVuJ3QgdXNlZCBpbiBwcm9kdWN0aW9uLlxuICAgICAgICBidW5kbGVQYXRoOiBcIlwiLFxuICAgICAgICBmaWxlbmFtZTogXCJcIlxuICAgIH0sXG4gICAgdXNlcmxhbmRcbn0pO1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1wYWdlcy1hcGkuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fask&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fask.js&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api)/./pages/api/ask.js":
/*!**************************!*\
  !*** ./pages/api/ask.js ***!
  \**************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var openai__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! openai */ \"openai\");\n/* harmony import */ var axios__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! axios */ \"axios\");\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! fs */ \"fs\");\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(fs__WEBPACK_IMPORTED_MODULE_2__);\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([openai__WEBPACK_IMPORTED_MODULE_0__, axios__WEBPACK_IMPORTED_MODULE_1__]);\n([openai__WEBPACK_IMPORTED_MODULE_0__, axios__WEBPACK_IMPORTED_MODULE_1__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n\nconst openaiAPIKey = process.env.OPENAI_KEY;\nconst openaiModel = process.env.OPENAI_MODEL;\nconsole.log(openaiAPIKey);\nconsole.log(openaiModel);\nconst openai = new openai__WEBPACK_IMPORTED_MODULE_0__[\"default\"]({\n    apiKey: openaiAPIKey\n});\nconst documentQuestionAssistantID = \"asst_K5SzoP1rWSMLS30aIFow9bsX\";\nasync function getDocumentTextFromLink(link) {\n    // Create assistant to get inner content from document. Already created the assistant\n    const instructions = `You are a really good assistant, ready to get the inner content from the document link provided to you. You summarize it in a shorter, digestible way, while still keeping in all necessary details.`;\n    const assistant = await openai.beta.assistants.create({\n        name: \"Document Inner Content Assistant\",\n        instructions: instructions,\n        model: openaiModel || \"gpt-4-turbo\",\n        tools: [\n            {\n                type: \"file_search\"\n            }\n        ]\n    });\n    const assistantId = assistant.id;\n    // Download the file URL and save it with the file name\n    const fileName = link.split(\"/\").pop();\n    const response = await axios__WEBPACK_IMPORTED_MODULE_1__[\"default\"].get(link, {\n        responseType: \"arraybuffer\"\n    });\n    const buffer = Buffer.from(response.data);\n    fs__WEBPACK_IMPORTED_MODULE_2___default().writeFileSync(fileName, buffer);\n    console.log(`File \"${fileName}\" downloaded successfully.`);\n    //creating a vector store:\n    const fileStreams = [\n        \"filename\"\n    ].map((path)=>fs__WEBPACK_IMPORTED_MODULE_2___default().createReadStream(path));\n    // Create a vector store including our two files.\n    let vectorStore = await openai.beta.vectorStores.create({\n        name: fileName.split(\".\")[0]\n    });\n    // await openai.beta.vectorStores.fileBatches.uploadAndPoll(vectorStore.id, fileStreams)\n    //\n    // await openai.beta.assistants.update(assistant.id, {\n    //   tool_resources: { file_search: { vector_store_ids: [vectorStore.id] } },\n    // });\n    // A user wants to attach a file to a specific message, let's upload it.\n    const file = await openai.files.create({\n        file: fs__WEBPACK_IMPORTED_MODULE_2___default().createReadStream(fileName),\n        purpose: \"assistants\"\n    });\n    const thread = await openai.beta.threads.create({\n        messages: [\n            {\n                role: \"user\",\n                content: \"Summarize this in a digestable, and well informed way, making it shorter while still having all the necessary details.\",\n                // Attach the new file to the message.\n                attachments: [\n                    {\n                        file_id: file.id,\n                        tools: [\n                            {\n                                type: \"file_search\"\n                            }\n                        ]\n                    }\n                ]\n            }\n        ]\n    });\n    // The thread now has a vector store in its tool resources.\n    console.log(thread.tool_resources?.file_search);\n    const run = await openai.beta.threads.runs.createAndPoll(thread.id, {\n        assistant_id: assistant.id\n    });\n    const messages = await openai.beta.threads.messages.list(thread.id, {\n        run_id: run.id\n    });\n    const message = messages.data.pop();\n    if (message.content[0].type === \"text\") {\n        const { text } = message.content[0];\n        const { annotations } = text;\n        const citations = [];\n        let index = 0;\n        for (let annotation of annotations){\n            text.value = text.value.replace(annotation.text, \"[\" + index + \"]\");\n            const { file_citation } = annotation;\n            if (file_citation) {\n                const citedFile = await openai.files.retrieve(file_citation.file_id);\n                citations.push(\"[\" + index + \"]\" + citedFile.filename);\n            }\n            index++;\n        }\n        console.log(text.value);\n        console.log(citations.join(\"\\n\"));\n        // Delete the file after use\n        fs__WEBPACK_IMPORTED_MODULE_2___default().unlinkSync(fileName);\n        console.log(`File \"${fileName}\" deleted successfully.`);\n        return text.value;\n    }\n}\nasync function handler(req, res) {\n    if (req.method === \"POST\") {\n        try {\n            // Parse the request body\n            const body = JSON.parse(req.body);\n            const linkOrText = body.linkOrText;\n            const question = body.question;\n            console.log(\"Link or Text: \", linkOrText);\n            console.log(\"Question: \", question);\n            // creating assistant (I already created it)\n            // const instructions = `You are a really good assistant, ready to answer the question based off of the question and document link or text provided to you. If the user provides a link, you call the \"getDocumentTextFromLink\" from your arsenal, to get the returning text from the document, and answer the user's question.`;\n            // const assistant = await openai.beta.assistants.create({\n            //   name: \"Document Question Assistant\",\n            //   instructions: instructions,\n            //   tools: [\n            //     {\n            //       type: \"function\",\n            //       function: {\n            //         name: \"getDocumentTextFromLink\",\n            //         description: \"Get the text string as a return from a document by only providing a link\",\n            //         parameters: {\n            //           type: \"object\",\n            //           properties: {\n            //             link: {\n            //               type: \"string\",\n            //               description: \"The full link of the document.\",\n            //             },\n            //           },\n            //           required: [\"link\"],\n            //         },\n            //       },\n            //     },\n            //   ],\n            //   model: openaiModel || \"gpt-4-turbo\"\n            // });\n            const thread = await openai.beta.threads.create();\n            let userMessage;\n            if (linkOrText.includes(\"http\")) {\n                userMessage = `My question: ${question}. Here is the document I want to ask the question about: ${linkOrText}`;\n            } else {\n                userMessage = `My question: ${question}. The question is about this: ${linkOrText}`;\n            }\n            const message = await openai.beta.threads.messages.create(thread.id, {\n                role: \"user\",\n                content: userMessage\n            });\n            let run = await openai.beta.threads.runs.create(thread.id, {\n                assistant_id: documentQuestionAssistantID,\n                instructions: \"Please answer the user question based off of the link or text provided. If the user provided a link, call the 'getdocumentTextFromLink' function to get the text from the document. Answer the users question to the best of your ability, and provide a detailed response that will satisfies the users question.\"\n            });\n            while(true){\n                await delay(2500); // Delay for 5 seconds\n                const runStatus = await openai.beta.threads.runs.retrieve(thread.id, run.id);\n                if (runStatus.status === \"completed\") {\n                    console.log(\"Completed\");\n                    const messages = await openai.beta.threads.messages.list(thread.id);\n                    for (const message of messages.data){\n                        const messageStr = message.content[0].text.value;\n                        console.log(`${message.role} > ${messageStr}`);\n                        return res.status(200).json({\n                            message: messageStr\n                        });\n                    }\n                    break; // Exit the loop once completed\n                } else if (runStatus.status === \"requires_action\") {\n                    console.log(\"Requires action\");\n                    const requiredActions = runStatus.required_action.submit_tool_outputs;\n                    console.log(requiredActions);\n                    const toolsOutput = [];\n                    for(let i = 0; i < requiredActions[\"tool_calls\"].length; i++){\n                        const action = requiredActions[\"tool_calls\"][i];\n                        const functionName = action[\"function\"][\"name\"];\n                        const args = JSON.parse(action[\"function\"][\"arguments\"]);\n                        console.log(\"action\", action);\n                        console.log(\"functionName\", functionName);\n                        console.log(\"args\", args);\n                        if (functionName == \"getDocumentTextFromLink\") {\n                            console.log(\"Function found\");\n                            console.log(\"Link arg: \", args.link);\n                            const output = await getDocumentTextFromLink(args.link);\n                            console.log(\"Output: \", output);\n                            toolsOutput.push({\n                                \"tool_call_id\": action[\"id\"],\n                                \"output\": output\n                            });\n                        } else {\n                            console.log(\"Function not found\");\n                        }\n                    }\n                    // Submit tools outputs back to the Assistants API \n                    console.log(\"Submitting tool outputs...\");\n                    run = await openai.beta.threads.runs.submitToolOutputsAndPoll(thread.id, run.id, {\n                        tool_outputs: toolsOutput\n                    });\n                    console.log(\"Tool outputs submitted\");\n                } else {\n                    console.log(\"Waiting for the Assistant to process...\");\n                    console.log(runStatus.status);\n                }\n            }\n        } catch (error) {\n            console.error(\"Error processing request:\", error);\n            res.status(500).json({\n                error: \"Error processing request\"\n            });\n        }\n    } else {\n        res.status(405).json({\n            error: \"Method not allowed\"\n        });\n    }\n}\n// Function to create a delay using a promise\nfunction delay(ms) {\n    return new Promise((resolve)=>setTimeout(resolve, ms));\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Y2s6Ly9teS1uZXh0LWFwcC8uL3BhZ2VzL2FwaS9hc2suanM/M2VlZiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgT3BlbkFJIGZyb20gXCJvcGVuYWlcIjtcbmltcG9ydCBheGlvcyBmcm9tICdheGlvcyc7XG5pbXBvcnQgZnMgZnJvbSBcImZzXCI7XG5cbmNvbnN0IG9wZW5haUFQSUtleSA9IHByb2Nlc3MuZW52Lk9QRU5BSV9LRVk7XG5jb25zdCBvcGVuYWlNb2RlbCA9IHByb2Nlc3MuZW52Lk9QRU5BSV9NT0RFTDtcblxuY29uc29sZS5sb2cob3BlbmFpQVBJS2V5KVxuY29uc29sZS5sb2cob3BlbmFpTW9kZWwpXG5cbmNvbnN0IG9wZW5haSA9IG5ldyBPcGVuQUkoe2FwaUtleTogb3BlbmFpQVBJS2V5fSlcblxuY29uc3QgZG9jdW1lbnRRdWVzdGlvbkFzc2lzdGFudElEID0gXCJhc3N0X0s1U3pvUDFyV1NNTFMzMGFJRm93OWJzWFwiXG5cbmFzeW5jIGZ1bmN0aW9uIGdldERvY3VtZW50VGV4dEZyb21MaW5rKGxpbmspIHtcbiAgLy8gQ3JlYXRlIGFzc2lzdGFudCB0byBnZXQgaW5uZXIgY29udGVudCBmcm9tIGRvY3VtZW50LiBBbHJlYWR5IGNyZWF0ZWQgdGhlIGFzc2lzdGFudFxuICBjb25zdCBpbnN0cnVjdGlvbnMgPSBgWW91IGFyZSBhIHJlYWxseSBnb29kIGFzc2lzdGFudCwgcmVhZHkgdG8gZ2V0IHRoZSBpbm5lciBjb250ZW50IGZyb20gdGhlIGRvY3VtZW50IGxpbmsgcHJvdmlkZWQgdG8geW91LiBZb3Ugc3VtbWFyaXplIGl0IGluIGEgc2hvcnRlciwgZGlnZXN0aWJsZSB3YXksIHdoaWxlIHN0aWxsIGtlZXBpbmcgaW4gYWxsIG5lY2Vzc2FyeSBkZXRhaWxzLmA7XG5cbiAgY29uc3QgYXNzaXN0YW50ID0gYXdhaXQgb3BlbmFpLmJldGEuYXNzaXN0YW50cy5jcmVhdGUoe1xuICAgIG5hbWU6IFwiRG9jdW1lbnQgSW5uZXIgQ29udGVudCBBc3Npc3RhbnRcIixcbiAgICBpbnN0cnVjdGlvbnM6IGluc3RydWN0aW9ucyxcbiAgICBtb2RlbDogb3BlbmFpTW9kZWwgfHwgXCJncHQtNC10dXJib1wiLFxuICAgIHRvb2xzOiBbeyB0eXBlOiBcImZpbGVfc2VhcmNoXCIgfV0sXG4gIH0pO1xuXG4gIGNvbnN0IGFzc2lzdGFudElkID0gYXNzaXN0YW50LmlkO1xuXG4gIC8vIERvd25sb2FkIHRoZSBmaWxlIFVSTCBhbmQgc2F2ZSBpdCB3aXRoIHRoZSBmaWxlIG5hbWVcbiAgY29uc3QgZmlsZU5hbWUgPSBsaW5rLnNwbGl0KFwiL1wiKS5wb3AoKTtcbiAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBheGlvcy5nZXQobGluaywgeyByZXNwb25zZVR5cGU6ICdhcnJheWJ1ZmZlcicgfSk7XG4gIGNvbnN0IGJ1ZmZlciA9IEJ1ZmZlci5mcm9tKHJlc3BvbnNlLmRhdGEpO1xuXG4gIGZzLndyaXRlRmlsZVN5bmMoZmlsZU5hbWUsIGJ1ZmZlcik7XG4gIGNvbnNvbGUubG9nKGBGaWxlIFwiJHtmaWxlTmFtZX1cIiBkb3dubG9hZGVkIHN1Y2Nlc3NmdWxseS5gKTtcblxuICAvL2NyZWF0aW5nIGEgdmVjdG9yIHN0b3JlOlxuICBjb25zdCBmaWxlU3RyZWFtcyA9IFtcImZpbGVuYW1lXCJdLm1hcCgocGF0aCkgPT5cbiAgICBmcy5jcmVhdGVSZWFkU3RyZWFtKHBhdGgpLFxuICApO1xuXG4gIC8vIENyZWF0ZSBhIHZlY3RvciBzdG9yZSBpbmNsdWRpbmcgb3VyIHR3byBmaWxlcy5cbiAgbGV0IHZlY3RvclN0b3JlID0gYXdhaXQgb3BlbmFpLmJldGEudmVjdG9yU3RvcmVzLmNyZWF0ZSh7XG4gICAgbmFtZTogZmlsZU5hbWUuc3BsaXQoXCIuXCIpWzBdLFxuICB9KTtcblxuICAvLyBhd2FpdCBvcGVuYWkuYmV0YS52ZWN0b3JTdG9yZXMuZmlsZUJhdGNoZXMudXBsb2FkQW5kUG9sbCh2ZWN0b3JTdG9yZS5pZCwgZmlsZVN0cmVhbXMpXG4gIC8vXG4gIC8vIGF3YWl0IG9wZW5haS5iZXRhLmFzc2lzdGFudHMudXBkYXRlKGFzc2lzdGFudC5pZCwge1xuICAvLyAgIHRvb2xfcmVzb3VyY2VzOiB7IGZpbGVfc2VhcmNoOiB7IHZlY3Rvcl9zdG9yZV9pZHM6IFt2ZWN0b3JTdG9yZS5pZF0gfSB9LFxuICAvLyB9KTtcbiAgXG4gIC8vIEEgdXNlciB3YW50cyB0byBhdHRhY2ggYSBmaWxlIHRvIGEgc3BlY2lmaWMgbWVzc2FnZSwgbGV0J3MgdXBsb2FkIGl0LlxuICBjb25zdCBmaWxlID0gYXdhaXQgb3BlbmFpLmZpbGVzLmNyZWF0ZSh7XG4gICAgZmlsZTogZnMuY3JlYXRlUmVhZFN0cmVhbShmaWxlTmFtZSksXG4gICAgcHVycG9zZTogXCJhc3Npc3RhbnRzXCIsXG4gIH0pO1xuXG4gIGNvbnN0IHRocmVhZCA9IGF3YWl0IG9wZW5haS5iZXRhLnRocmVhZHMuY3JlYXRlKHtcbiAgICBtZXNzYWdlczogW1xuICAgICAge1xuICAgICAgICByb2xlOiBcInVzZXJcIixcbiAgICAgICAgY29udGVudDogXCJTdW1tYXJpemUgdGhpcyBpbiBhIGRpZ2VzdGFibGUsIGFuZCB3ZWxsIGluZm9ybWVkIHdheSwgbWFraW5nIGl0IHNob3J0ZXIgd2hpbGUgc3RpbGwgaGF2aW5nIGFsbCB0aGUgbmVjZXNzYXJ5IGRldGFpbHMuXCIsXG4gICAgICAgIC8vIEF0dGFjaCB0aGUgbmV3IGZpbGUgdG8gdGhlIG1lc3NhZ2UuXG4gICAgICAgIGF0dGFjaG1lbnRzOiBbeyBmaWxlX2lkOiBmaWxlLmlkLCB0b29sczogW3sgdHlwZTogXCJmaWxlX3NlYXJjaFwiIH1dIH1dLFxuICAgICAgfSxcbiAgICBdLFxuICB9KTtcblxuICAvLyBUaGUgdGhyZWFkIG5vdyBoYXMgYSB2ZWN0b3Igc3RvcmUgaW4gaXRzIHRvb2wgcmVzb3VyY2VzLlxuICBjb25zb2xlLmxvZyh0aHJlYWQudG9vbF9yZXNvdXJjZXM/LmZpbGVfc2VhcmNoKTtcblxuICBjb25zdCBydW4gPSBhd2FpdCBvcGVuYWkuYmV0YS50aHJlYWRzLnJ1bnMuY3JlYXRlQW5kUG9sbCh0aHJlYWQuaWQsIHtcbiAgICBhc3Npc3RhbnRfaWQ6IGFzc2lzdGFudC5pZCxcbiAgfSk7XG5cbiAgY29uc3QgbWVzc2FnZXMgPSBhd2FpdCBvcGVuYWkuYmV0YS50aHJlYWRzLm1lc3NhZ2VzLmxpc3QodGhyZWFkLmlkLCB7XG4gICAgcnVuX2lkOiBydW4uaWQsXG4gIH0pO1xuXG4gIGNvbnN0IG1lc3NhZ2UgPSBtZXNzYWdlcy5kYXRhLnBvcCgpO1xuICBpZiAobWVzc2FnZS5jb250ZW50WzBdLnR5cGUgPT09IFwidGV4dFwiKSB7XG4gICAgY29uc3QgeyB0ZXh0IH0gPSBtZXNzYWdlLmNvbnRlbnRbMF07XG4gICAgY29uc3QgeyBhbm5vdGF0aW9ucyB9ID0gdGV4dDtcbiAgICBjb25zdCBjaXRhdGlvbnMgPSBbXTtcblxuICAgIGxldCBpbmRleCA9IDA7XG4gICAgZm9yIChsZXQgYW5ub3RhdGlvbiBvZiBhbm5vdGF0aW9ucykge1xuICAgICAgdGV4dC52YWx1ZSA9IHRleHQudmFsdWUucmVwbGFjZShhbm5vdGF0aW9uLnRleHQsIFwiW1wiICsgaW5kZXggKyBcIl1cIik7XG4gICAgICBjb25zdCB7IGZpbGVfY2l0YXRpb24gfSA9IGFubm90YXRpb247XG4gICAgICBpZiAoZmlsZV9jaXRhdGlvbikge1xuICAgICAgICBjb25zdCBjaXRlZEZpbGUgPSBhd2FpdCBvcGVuYWkuZmlsZXMucmV0cmlldmUoZmlsZV9jaXRhdGlvbi5maWxlX2lkKTtcbiAgICAgICAgY2l0YXRpb25zLnB1c2goXCJbXCIgKyBpbmRleCArIFwiXVwiICsgY2l0ZWRGaWxlLmZpbGVuYW1lKTtcbiAgICAgIH1cbiAgICAgIGluZGV4Kys7XG4gICAgfVxuXG4gICAgY29uc29sZS5sb2codGV4dC52YWx1ZSk7XG4gICAgY29uc29sZS5sb2coY2l0YXRpb25zLmpvaW4oXCJcXG5cIikpO1xuXG4gICAgLy8gRGVsZXRlIHRoZSBmaWxlIGFmdGVyIHVzZVxuICAgIGZzLnVubGlua1N5bmMoZmlsZU5hbWUpO1xuICAgIGNvbnNvbGUubG9nKGBGaWxlIFwiJHtmaWxlTmFtZX1cIiBkZWxldGVkIHN1Y2Nlc3NmdWxseS5gKTtcbiAgICByZXR1cm4gdGV4dC52YWx1ZTtcbiAgfVxuXG59XG5leHBvcnQgZGVmYXVsdCBhc3luYyBmdW5jdGlvbiBoYW5kbGVyKHJlcSwgcmVzKSB7XG5cbiAgaWYgKHJlcS5tZXRob2QgPT09ICdQT1NUJykge1xuICAgIHRyeSB7XG4gICAgICAvLyBQYXJzZSB0aGUgcmVxdWVzdCBib2R5XG4gICAgICBjb25zdCBib2R5ID0gSlNPTi5wYXJzZShyZXEuYm9keSk7XG5cbiAgICAgIGNvbnN0IGxpbmtPclRleHQgPSBib2R5LmxpbmtPclRleHQ7XG4gICAgICBjb25zdCBxdWVzdGlvbiA9IGJvZHkucXVlc3Rpb247XG4gICAgICBjb25zb2xlLmxvZyhcIkxpbmsgb3IgVGV4dDogXCIsIGxpbmtPclRleHQpO1xuICAgICAgY29uc29sZS5sb2coXCJRdWVzdGlvbjogXCIsIHF1ZXN0aW9uKTtcbiAgICBcbiAgICAgIC8vIGNyZWF0aW5nIGFzc2lzdGFudCAoSSBhbHJlYWR5IGNyZWF0ZWQgaXQpXG4gICAgICAvLyBjb25zdCBpbnN0cnVjdGlvbnMgPSBgWW91IGFyZSBhIHJlYWxseSBnb29kIGFzc2lzdGFudCwgcmVhZHkgdG8gYW5zd2VyIHRoZSBxdWVzdGlvbiBiYXNlZCBvZmYgb2YgdGhlIHF1ZXN0aW9uIGFuZCBkb2N1bWVudCBsaW5rIG9yIHRleHQgcHJvdmlkZWQgdG8geW91LiBJZiB0aGUgdXNlciBwcm92aWRlcyBhIGxpbmssIHlvdSBjYWxsIHRoZSBcImdldERvY3VtZW50VGV4dEZyb21MaW5rXCIgZnJvbSB5b3VyIGFyc2VuYWwsIHRvIGdldCB0aGUgcmV0dXJuaW5nIHRleHQgZnJvbSB0aGUgZG9jdW1lbnQsIGFuZCBhbnN3ZXIgdGhlIHVzZXIncyBxdWVzdGlvbi5gO1xuICAgICAgLy8gY29uc3QgYXNzaXN0YW50ID0gYXdhaXQgb3BlbmFpLmJldGEuYXNzaXN0YW50cy5jcmVhdGUoe1xuICAgICAgLy8gICBuYW1lOiBcIkRvY3VtZW50IFF1ZXN0aW9uIEFzc2lzdGFudFwiLFxuICAgICAgLy8gICBpbnN0cnVjdGlvbnM6IGluc3RydWN0aW9ucyxcbiAgICAgIC8vICAgdG9vbHM6IFtcbiAgICAgIC8vICAgICB7XG4gICAgICAvLyAgICAgICB0eXBlOiBcImZ1bmN0aW9uXCIsXG4gICAgICAvLyAgICAgICBmdW5jdGlvbjoge1xuICAgICAgLy8gICAgICAgICBuYW1lOiBcImdldERvY3VtZW50VGV4dEZyb21MaW5rXCIsXG4gICAgICAvLyAgICAgICAgIGRlc2NyaXB0aW9uOiBcIkdldCB0aGUgdGV4dCBzdHJpbmcgYXMgYSByZXR1cm4gZnJvbSBhIGRvY3VtZW50IGJ5IG9ubHkgcHJvdmlkaW5nIGEgbGlua1wiLFxuICAgICAgLy8gICAgICAgICBwYXJhbWV0ZXJzOiB7XG4gICAgICAvLyAgICAgICAgICAgdHlwZTogXCJvYmplY3RcIixcbiAgICAgIC8vICAgICAgICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAvLyAgICAgICAgICAgICBsaW5rOiB7XG4gICAgICAvLyAgICAgICAgICAgICAgIHR5cGU6IFwic3RyaW5nXCIsXG4gICAgICAvLyAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIlRoZSBmdWxsIGxpbmsgb2YgdGhlIGRvY3VtZW50LlwiLFxuICAgICAgLy8gICAgICAgICAgICAgfSxcbiAgICAgIC8vICAgICAgICAgICB9LFxuICAgICAgLy8gICAgICAgICAgIHJlcXVpcmVkOiBbXCJsaW5rXCJdLFxuICAgICAgLy8gICAgICAgICB9LFxuICAgICAgLy8gICAgICAgfSxcbiAgICAgIC8vICAgICB9LFxuICAgICAgLy8gICBdLFxuICAgICAgLy8gICBtb2RlbDogb3BlbmFpTW9kZWwgfHwgXCJncHQtNC10dXJib1wiXG4gICAgICAvLyB9KTtcblxuICAgICAgY29uc3QgdGhyZWFkID0gYXdhaXQgb3BlbmFpLmJldGEudGhyZWFkcy5jcmVhdGUoKTtcblxuICAgICAgbGV0IHVzZXJNZXNzYWdlO1xuICAgICAgaWYgKGxpbmtPclRleHQuaW5jbHVkZXMoXCJodHRwXCIpKSB7XG4gICAgICAgIHVzZXJNZXNzYWdlID0gYE15IHF1ZXN0aW9uOiAke3F1ZXN0aW9ufS4gSGVyZSBpcyB0aGUgZG9jdW1lbnQgSSB3YW50IHRvIGFzayB0aGUgcXVlc3Rpb24gYWJvdXQ6ICR7bGlua09yVGV4dH1gXG4gICAgICB9IGVsc2Uge1xuICAgICAgICB1c2VyTWVzc2FnZSA9IGBNeSBxdWVzdGlvbjogJHtxdWVzdGlvbn0uIFRoZSBxdWVzdGlvbiBpcyBhYm91dCB0aGlzOiAke2xpbmtPclRleHR9YFxuICAgICAgfVxuXG4gICAgICBjb25zdCBtZXNzYWdlID0gYXdhaXQgb3BlbmFpLmJldGEudGhyZWFkcy5tZXNzYWdlcy5jcmVhdGUoXG4gICAgICAgIHRocmVhZC5pZCxcbiAgICAgICAge1xuICAgICAgICAgIHJvbGU6IFwidXNlclwiLFxuICAgICAgICAgIGNvbnRlbnQ6IHVzZXJNZXNzYWdlLFxuICAgICAgICB9XG4gICAgICApO1xuICAgICAgIFxuICAgICAgbGV0IHJ1biA9IGF3YWl0IG9wZW5haS5iZXRhLnRocmVhZHMucnVucy5jcmVhdGUoXG4gICAgICAgIHRocmVhZC5pZCxcbiAgICAgICAgeyBcbiAgICAgICAgICBhc3Npc3RhbnRfaWQ6IGRvY3VtZW50UXVlc3Rpb25Bc3Npc3RhbnRJRCxcbiAgICAgICAgICBpbnN0cnVjdGlvbnM6IFwiUGxlYXNlIGFuc3dlciB0aGUgdXNlciBxdWVzdGlvbiBiYXNlZCBvZmYgb2YgdGhlIGxpbmsgb3IgdGV4dCBwcm92aWRlZC4gSWYgdGhlIHVzZXIgcHJvdmlkZWQgYSBsaW5rLCBjYWxsIHRoZSAnZ2V0ZG9jdW1lbnRUZXh0RnJvbUxpbmsnIGZ1bmN0aW9uIHRvIGdldCB0aGUgdGV4dCBmcm9tIHRoZSBkb2N1bWVudC4gQW5zd2VyIHRoZSB1c2VycyBxdWVzdGlvbiB0byB0aGUgYmVzdCBvZiB5b3VyIGFiaWxpdHksIGFuZCBwcm92aWRlIGEgZGV0YWlsZWQgcmVzcG9uc2UgdGhhdCB3aWxsIHNhdGlzZmllcyB0aGUgdXNlcnMgcXVlc3Rpb24uXCIsXG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgICBcbiAgICAgIHdoaWxlICh0cnVlKSB7XG4gICAgICAgIGF3YWl0IGRlbGF5KDI1MDApOyAvLyBEZWxheSBmb3IgNSBzZWNvbmRzXG5cbiAgICAgICAgY29uc3QgcnVuU3RhdHVzID0gYXdhaXQgb3BlbmFpLmJldGEudGhyZWFkcy5ydW5zLnJldHJpZXZlKFxuICAgICAgICAgIHRocmVhZC5pZCxcbiAgICAgICAgICBydW4uaWRcbiAgICAgICAgKTtcblxuICAgICAgICBpZiAocnVuU3RhdHVzLnN0YXR1cyA9PT0gJ2NvbXBsZXRlZCcpIHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhcIkNvbXBsZXRlZFwiKVxuICAgICAgICAgIGNvbnN0IG1lc3NhZ2VzID0gYXdhaXQgb3BlbmFpLmJldGEudGhyZWFkcy5tZXNzYWdlcy5saXN0KFxuICAgICAgICAgICAgdGhyZWFkLmlkXG4gICAgICAgICAgKTtcblxuICAgICAgICAgIGZvciAoY29uc3QgbWVzc2FnZSBvZiBtZXNzYWdlcy5kYXRhKSB7XG4gICAgICAgICAgICBjb25zdCBtZXNzYWdlU3RyID0gbWVzc2FnZS5jb250ZW50WzBdLnRleHQudmFsdWU7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhgJHttZXNzYWdlLnJvbGV9ID4gJHttZXNzYWdlU3RyfWApXG4gICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLmpzb24oeyBtZXNzYWdlOiBtZXNzYWdlU3RyIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICBicmVhazsgLy8gRXhpdCB0aGUgbG9vcCBvbmNlIGNvbXBsZXRlZFxuICAgICAgICB9IFxuXG4gICAgICAgIGVsc2UgaWYgKHJ1blN0YXR1cy5zdGF0dXMgPT09ICdyZXF1aXJlc19hY3Rpb24nKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coXCJSZXF1aXJlcyBhY3Rpb25cIilcbiAgICAgICAgICBjb25zdCByZXF1aXJlZEFjdGlvbnMgPSBydW5TdGF0dXMucmVxdWlyZWRfYWN0aW9uLnN1Ym1pdF90b29sX291dHB1dHM7XG4gICAgICAgICAgY29uc29sZS5sb2cocmVxdWlyZWRBY3Rpb25zKVxuICAgICAgICAgIGNvbnN0IHRvb2xzT3V0cHV0ID0gW11cbiAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHJlcXVpcmVkQWN0aW9uc1tcInRvb2xfY2FsbHNcIl0ubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGNvbnN0IGFjdGlvbiA9IHJlcXVpcmVkQWN0aW9uc1tcInRvb2xfY2FsbHNcIl1baV1cbiAgICAgICAgICAgIGNvbnN0IGZ1bmN0aW9uTmFtZSA9IGFjdGlvbltcImZ1bmN0aW9uXCJdW1wibmFtZVwiXVxuICAgICAgICAgICAgY29uc3QgYXJncyA9IEpTT04ucGFyc2UoYWN0aW9uW1wiZnVuY3Rpb25cIl1bXCJhcmd1bWVudHNcIl0pXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcImFjdGlvblwiLCBhY3Rpb24pXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcImZ1bmN0aW9uTmFtZVwiLCBmdW5jdGlvbk5hbWUpXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcImFyZ3NcIiwgYXJncylcbiAgICAgICAgICAgIGlmIChmdW5jdGlvbk5hbWUgPT0gXCJnZXREb2N1bWVudFRleHRGcm9tTGlua1wiKSB7XG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiRnVuY3Rpb24gZm91bmRcIilcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJMaW5rIGFyZzogXCIsIGFyZ3MubGluaylcbiAgICAgICAgICAgICAgY29uc3Qgb3V0cHV0ID0gYXdhaXQgZ2V0RG9jdW1lbnRUZXh0RnJvbUxpbmsoYXJncy5saW5rKVxuICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIk91dHB1dDogXCIsIG91dHB1dClcblxuICAgICAgICAgICAgICB0b29sc091dHB1dC5wdXNoKHtcbiAgICAgICAgICAgICAgICBcInRvb2xfY2FsbF9pZFwiOiBhY3Rpb25bXCJpZFwiXSxcbiAgICAgICAgICAgICAgICBcIm91dHB1dFwiOiBvdXRwdXQsXG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJGdW5jdGlvbiBub3QgZm91bmRcIilcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvLyBTdWJtaXQgdG9vbHMgb3V0cHV0cyBiYWNrIHRvIHRoZSBBc3Npc3RhbnRzIEFQSSBcbiAgICAgICAgICBjb25zb2xlLmxvZyhcIlN1Ym1pdHRpbmcgdG9vbCBvdXRwdXRzLi4uXCIpXG4gICAgICAgICAgcnVuID0gYXdhaXQgb3BlbmFpLmJldGEudGhyZWFkcy5ydW5zLnN1Ym1pdFRvb2xPdXRwdXRzQW5kUG9sbChcbiAgICAgICAgICAgIHRocmVhZC5pZCxcbiAgICAgICAgICAgIHJ1bi5pZCxcbiAgICAgICAgICAgIHsgdG9vbF9vdXRwdXRzOiB0b29sc091dHB1dCB9XG4gICAgICAgICAgKTtcbiAgICAgICAgICBjb25zb2xlLmxvZyhcIlRvb2wgb3V0cHV0cyBzdWJtaXR0ZWRcIilcbiAgICAgICAgfVxuXG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgIGNvbnNvbGUubG9nKFwiV2FpdGluZyBmb3IgdGhlIEFzc2lzdGFudCB0byBwcm9jZXNzLi4uXCIpXG4gICAgICAgICAgY29uc29sZS5sb2cocnVuU3RhdHVzLnN0YXR1cyk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIFxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgcHJvY2Vzc2luZyByZXF1ZXN0OlwiLCBlcnJvcik7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7IGVycm9yOiBcIkVycm9yIHByb2Nlc3NpbmcgcmVxdWVzdFwiIH0pO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICByZXMuc3RhdHVzKDQwNSkuanNvbih7IGVycm9yOiBcIk1ldGhvZCBub3QgYWxsb3dlZFwiIH0pO1xuICB9XG59XG5cbi8vIEZ1bmN0aW9uIHRvIGNyZWF0ZSBhIGRlbGF5IHVzaW5nIGEgcHJvbWlzZVxuZnVuY3Rpb24gZGVsYXkobXMpIHtcbiAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCBtcykpO1xufVxuIl0sIm5hbWVzIjpbIk9wZW5BSSIsImF4aW9zIiwiZnMiLCJvcGVuYWlBUElLZXkiLCJwcm9jZXNzIiwiZW52IiwiT1BFTkFJX0tFWSIsIm9wZW5haU1vZGVsIiwiT1BFTkFJX01PREVMIiwiY29uc29sZSIsImxvZyIsIm9wZW5haSIsImFwaUtleSIsImRvY3VtZW50UXVlc3Rpb25Bc3Npc3RhbnRJRCIsImdldERvY3VtZW50VGV4dEZyb21MaW5rIiwibGluayIsImluc3RydWN0aW9ucyIsImFzc2lzdGFudCIsImJldGEiLCJhc3Npc3RhbnRzIiwiY3JlYXRlIiwibmFtZSIsIm1vZGVsIiwidG9vbHMiLCJ0eXBlIiwiYXNzaXN0YW50SWQiLCJpZCIsImZpbGVOYW1lIiwic3BsaXQiLCJwb3AiLCJyZXNwb25zZSIsImdldCIsInJlc3BvbnNlVHlwZSIsImJ1ZmZlciIsIkJ1ZmZlciIsImZyb20iLCJkYXRhIiwid3JpdGVGaWxlU3luYyIsImZpbGVTdHJlYW1zIiwibWFwIiwicGF0aCIsImNyZWF0ZVJlYWRTdHJlYW0iLCJ2ZWN0b3JTdG9yZSIsInZlY3RvclN0b3JlcyIsImZpbGUiLCJmaWxlcyIsInB1cnBvc2UiLCJ0aHJlYWQiLCJ0aHJlYWRzIiwibWVzc2FnZXMiLCJyb2xlIiwiY29udGVudCIsImF0dGFjaG1lbnRzIiwiZmlsZV9pZCIsInRvb2xfcmVzb3VyY2VzIiwiZmlsZV9zZWFyY2giLCJydW4iLCJydW5zIiwiY3JlYXRlQW5kUG9sbCIsImFzc2lzdGFudF9pZCIsImxpc3QiLCJydW5faWQiLCJtZXNzYWdlIiwidGV4dCIsImFubm90YXRpb25zIiwiY2l0YXRpb25zIiwiaW5kZXgiLCJhbm5vdGF0aW9uIiwidmFsdWUiLCJyZXBsYWNlIiwiZmlsZV9jaXRhdGlvbiIsImNpdGVkRmlsZSIsInJldHJpZXZlIiwicHVzaCIsImZpbGVuYW1lIiwiam9pbiIsInVubGlua1N5bmMiLCJoYW5kbGVyIiwicmVxIiwicmVzIiwibWV0aG9kIiwiYm9keSIsIkpTT04iLCJwYXJzZSIsImxpbmtPclRleHQiLCJxdWVzdGlvbiIsInVzZXJNZXNzYWdlIiwiaW5jbHVkZXMiLCJkZWxheSIsInJ1blN0YXR1cyIsInN0YXR1cyIsIm1lc3NhZ2VTdHIiLCJqc29uIiwicmVxdWlyZWRBY3Rpb25zIiwicmVxdWlyZWRfYWN0aW9uIiwic3VibWl0X3Rvb2xfb3V0cHV0cyIsInRvb2xzT3V0cHV0IiwiaSIsImxlbmd0aCIsImFjdGlvbiIsImZ1bmN0aW9uTmFtZSIsImFyZ3MiLCJvdXRwdXQiLCJzdWJtaXRUb29sT3V0cHV0c0FuZFBvbGwiLCJ0b29sX291dHB1dHMiLCJlcnJvciIsIm1zIiwiUHJvbWlzZSIsInJlc29sdmUiLCJzZXRUaW1lb3V0Il0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./pages/api/ask.js\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fask&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fask.js&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();